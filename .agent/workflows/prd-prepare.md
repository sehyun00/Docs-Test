---
description: PRD inbox의 자유 형식 파일을 정형화된 초안으로 변환
---
// turbo-all

# /prd-prepare 워크플로우

PRD `_inbox/` 디렉토리의 자유 형식 파일들을 분석하여 `_staging/`에 정형화된 초안을 생성합니다.

## 실행 옵션

1. `/prd-prepare` : ⚠️ 전체 처리. 파일이 많거나 테이블이 많으면 정확도가 떨어질 수 있음.
2. `/prd-prepare {domain}` : 특정 도메인만 집중 처리. **(권장)**

### 도메인 추론 방식

도메인 목록은 `specs/` 하위 전체 디렉토리에서 자동 추론합니다:

```
specs/
├── db/{domain}/        → 도메인 추출
├── api/{domain}/       → 도메인 추출
├── ui/{domain}/        → 도메인 추출
└── logic/{domain}/     → 도메인 추출

전체 도메인 = 모든 타입에서 발견된 디렉토리명의 합집합
```

## 파이프라인 위치

```
_inbox/ (자유형식) → [/prd-prepare] → _staging/ (정형화) → [/prd-process] → specs/ (최종)
```

---

## 워크플로우 단계 (도메인 지정 시)

### 1. Inbox 스캔 및 필터링

```
1. AI_PRD/_inbox/ 디렉토리의 모든 파일 목록 확인
2. README.md 제외
3. 각 파일 내용 읽기
4. 지정된 도메인에 해당하는 테이블/항목만 추출
   - 도메인 미지정 시: 모든 항목 처리 (⚠️ 정확도 저하 가능)
```

### 2. 기존 스펙 정밀 로드 ⭐

```
⚠️ 핵심: 도메인 지정의 최대 장점!

해당 도메인의 기존 specs 파일을 전부 읽어서 정밀 비교:
- specs/db/{domain}/*.md 전체 로드
- specs/api/{domain}/*.md 전체 로드
- specs/ui/{domain}/*.md 전체 로드
- 각 파일의 스키마, 컬럼 정보 파악

외부 도메인 참조:
- 다른 도메인으로 나가는 related 링크는 "파일 존재 여부"만 확인
- 내용은 읽지 않음 (토큰 절약)
```

### 3. NEW/UPDATE 정확한 판정

```
기존 스펙과 비교하여:
- 항목이 없음 → [NEW]
- 항목 존재 + 내용 변경 → [UPDATE] + 변경 사항 상세 기술
- 항목 존재 + 동일 → 스킵하고 알림
```

### 4. 파일별 내용 분석

```
각 항목에 대해:
1. 의도 파악:
   - 새로운 기능 요청 → [NEW]
   - 기존 기능 변경/추가 → [UPDATE]  
   - 기능 제거 요청 → [DELETE]
2. 스펙 유형 추론:
   - API 관련 → api
   - 데이터베이스 관련 → db
   - 화면/UI 관련 → ui
   - 비즈니스 로직 관련 → logic
3. Phase 추론:
   - 핵심 기능, 필수 → P1
   - 부가 기능, 확장 → P2
   - 고급 기능, 선택 → P3
```

### 5. 용어 정규화

```
팀원이 사용한 비공식 표현 → 정형화된 용어

예시:
- 축약어, 줄임말 → 정식 명칭
- 구어체 표현 → 기술 용어
- 모호한 지시 → 명확한 작업 유형 ([NEW], [UPDATE], [DELETE])
```

### 6. 초안 생성 (_staging/)

#### 파일 생성 전략

```
도메인 지정 시: 해당 도메인 파일 1개만 생성
- _staging/[NEW] {type}-{domain}.md
- _staging/[UPDATE] {type}-{domain}.md

도메인 미지정 시: 도메인별로 그룹핑하여 여러 파일 생성
```

#### 파일 내부 구조

```markdown
# {도메인} {타입} 스펙

## 원본 출처
> 원본 파일: {inbox 파일명}

## 항목별 작업 요약
| 항목 | 작업 | 기존 스펙 |
|------|------|----------|
| {item1} | UPDATE | specs/{type}/{domain}/{item1}.md |
| {item2} | NEW | - |

## AI 분석 결과
- 추론 유형: db / api / ui / logic
- 추론 Phase: P1 / P2 / P3
- 연관 기존 스펙: [목록]
- 비교한 기존 스펙 파일: [정밀 비교에 사용된 파일 목록] ⭐

---

## {item1} [UPDATE]

### 기존 스펙 요약
(기존 specs 파일에서 읽은 현재 내용)

### 변경 사항
(기존 대비 추가/수정/삭제되는 내용만)

---

## {item2} [NEW]

### 정형화된 초안
(전체 스펙 내용)

---

## 확인 필요 사항

> [!IMPORTANT]
> AI가 원본 파일에서 발견한 질문, 주석, 모호한 부분을 아래에 정리했습니다.

### 발견된 이슈 (원본에서 추출)
<!-- 
원본 파일에서 다음을 찾아 구체적으로 나열:
1. 주석에 있는 질문
2. TODO, FIXME, ??? 등의 마커
3. 모호하거나 불완전한 정의
4. 기존 스펙과 충돌하는 부분
-->

### 사용자 결정 필요
<!-- 
선택지 형태로 제공:
- [ ] 옵션 A (추천) - 설명
- [ ] 옵션 B - 설명
-->
```

### 7. 분석 결과 보고

```
📥 inbox 처리 결과 ({domain} 도메인)

| 원본 파일 | 항목 | 작업 | 기존 스펙 비교 |
|----------|------|------|--------------|
| {file} | {item} | UPDATE | ✅ 정밀 비교 완료 |

📂 생성된 파일: _staging/[{action}] {type}-{domain}.md
📖 비교에 사용된 기존 스펙: {n}개 파일

✅ _staging/ 폴더를 확인하고 검토해주세요.
   다른 도메인도 처리하려면: /prd-prepare {다른도메인}
   검토 완료 후: /prd-process
```

### 8. 원본 유지

```
- _inbox/ 파일은 그대로 유지 (삭제하지 않음)
- /prd-process 완료 후에만 _processed/로 이동
```

---

## 대규모 도메인 세분화 ⛔

특정 도메인에 항목이 너무 많으면 (10개 이상) **반드시 세분화해야 합니다**.

### 세분화 기준

```
1. 도메인 내 항목 수 확인
2. 10개 이상이면 ⛔ 파일 생성하지 않고 중단
3. 세분화 형식: {domain}-{subdomain}
   예: /prd-prepare {domain}-{subdomain}

세분화 방식:
- 기능별 그룹핑 (예: profile, article, social 등)
- 테이블 접두사 기준 그룹핑
- 관련성 기준 그룹핑
```

### 세분화 시 동작 (필수)

```
/prd-prepare {domain}
  ↓ 항목이 10개 이상이면

⛔ _staging/ 파일 생성하지 않음

대신 다음 메시지 출력:
"⛔ 이 도메인에는 {n}개 항목이 있습니다. (10개 초과)
정확도를 위해 세분화가 필요합니다.

발견된 그룹:
- {domain}-{group1}: {테이블 목록} ({n}개)
- {domain}-{group2}: {테이블 목록} ({n}개)
- ...

다음 중 하나를 선택해서 실행해주세요:
/prd-prepare {domain}-{group1}
/prd-prepare {domain}-{group2}
..."
```

### 주의사항

```
- 10개 이상이면 절대 1개 파일로 생성하지 않음
- 사용자가 서브도메인을 선택할 때까지 대기
- 서브도메인 지정 시 해당 그룹만 처리하여 파일 생성
```

---

## 처리할 수 없는 경우

| 상황                         | 처리                                                          |
| ---------------------------- | ------------------------------------------------------------- |
| 내용이 너무 모호함           | _staging/[UNCLEAR] {파일명}.md로 생성, 사용자에게 명확화 요청 |
| 이미지만 있음                | _staging/[IMAGE] {파일명}.md로 생성, 이미지 설명 요청         |
| 기존 스펙과 완전 동일        | 스킵하고 사용자에게 알림                                      |
| 지정 도메인에 해당 항목 없음 | "해당 도메인 항목이 없습니다" 알림                            |

---

## 주의사항

- 이 단계에서는 실제 specs/에 아무것도 생성하지 않음
- 사용자가 _staging/ 내용을 검토/수정할 시간을 줌
- 검토 완료 후 /prd-process로 최종 반영
- **도메인 지정 시 해당 도메인 기존 스펙을 정밀하게 읽고 비교** ⭐
