// 사용자 정보
Table users {
  id integer [primary key, increment]
  email varchar [not null]
  nickname varchar
  provider enum ('GOOGLE') // 소셜 제공자(현 구글)
  role enum ('USER', 'ADMIN') // 사용자, 관리자
  profile_image_url varchar
  refresh_token text // 토큰 갱신용
  created_at timestamp // 가입 날짜
  updated_at timestamp // 업데이트 날짜
  membership_type enum ('NOT') // 멤버쉽 여부(no, pro, expert 같은 구분을 위해 enum 사용)
  is_verified boolean // 본인인증 여부
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 포트폴리오
Table portfolios {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 어떤 사용자의 포트폴리오인지
  name varchar // 포트폴리오명
  description text // 포폴 설명
  account_id integer [ref: - accounts.id] // 한 계좌의 메인으로 설정된 포트폴리오인지
  banner_color varchar [default: '#4CAF93'] // 포트폴리오 배너 색상
  created_at timestamp // 생성 날짜
  updated_at timestamp // 업데이트 날짜
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 포트폴리오 내 항목들
Table portfolio_entries {
  id integer [primary key, increment]
  portfolio_id integer [ref: > portfolios.id]
  group varchar // 분류
  ticker varchar [not null] // 주식 ticker
  // stock_name varchar // 주식명
  target_weight decimal // 희망 비중(%)
  created_at timestamp // 생성 날짜
  updated_at timestamp // 업데이트 날짜
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 포트폴리오 내 현금 목표 비중
Table portfolio_cash_entries {
  id integer [primary key, increment]
  portfolio_id integer [ref: > portfolios.id]
  currency enum('KRW', 'USD', 'JPY') [not null, default: 'KRW'] // 통화
  target_weight decimal // 희망 비중(%)
  created_at timestamp // 생성 날짜
  updated_at timestamp // 업데이트 날짜
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 알림 설정
Table notification_settings {
  id integer [primary key, increment]
  portfolio_id integer [ref: - portfolios.id] // 포트폴리오와 1:1 관계
  is_enabled boolean [default: false]
  alert_cycle enum('WEEKLY') // 알림 주기
  alert_time time // 알림 발송 시간
  threshold_percentage decimal [default: 20.0] // 임계값 (±20%)
  updated_at timestamp
}

// 연동 계좌
Table accounts {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 어떤 사용자의 계좌인지
  brokerage_name varchar // 증권사 명
  account_number varchar // 계좌 번호(암호화)
  access_token text // API 접근 토큰
  refresh_token text // 토큰 갱신용
  is_connected boolean [default: false] // 현재 연결 여부
  created_at timestamp
  updated_at timestamp
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 계좌 내 항목들
Table account_entries {
  id integer [primary key, increment]
  account_id integer [ref: > accounts.id]
  group varchar // 분류
  ticker varchar // 주식 ticker
  // stock_name varchar // 주식명
  current_quantity decimal // 현재 수량
  bought_price decimal // 평단가
  currency enum ('KRW', 'USD', 'JPY') [default: 'KRW'] // 거래 통화
  exchange varchar // 거래소
  created_at timestamp // 생성 날짜
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 계좌 내 실제 현금 잔고
Table account_cash_entries {
  id integer [primary key, increment]
  account_id integer [ref: > accounts.id]
  currency enum('KRW', 'USD', 'JPY') [not null, default: 'KRW'] // 통화
  amount decimal [default: 0] // 실제 보유 금액
  created_at timestamp // 생성 날짜
  updated_at timestamp // 업데이트 날짜
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 사용자 설정값
Table settings {
  id integer [primary key, increment]
  user_id integer [ref: - users.id]
  is_nofitication boolean // 알림 설정 허용
  is_privacy boolean // 개인정보 허용
  is_tutorial_completed boolean // 최초 1회 튜토리얼 가이드 완료 여부
}

// 알림 스택
Table notifications {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 수신 대상자
  type enum('REBALANCING_CYCLE', 'THRESHOLD_BREACH', 'SYSTEM') [not null] // 알림 종류 1. 주기 2. 임계치 3. 시스템
  title varchar [not null] // 알림 제목
  message text [not null] // 알림 본문
  related_entity_id integer // 관련 포트폴리오 ID 등 (클릭 시 이동용)
  is_read boolean [default: false] // 읽음 여부
  created_at timestamp [default: `now()`]
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 커뮤니티 게시물
Table community_articles {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 작성자
  title varchar [not null] // 제목
  content text [not null] //  본문
  portfolio_id integer [ref: > portfolios.id] // 공유된 포트폴리오
  views long [default: 0] // 조회수
  like_count integer [default: 0] // 성능을 위한 역정규화
  created_at timestamp [default: `now()`] // 작성일
  updated_at timestamp // 업뎃일
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 게시물 이미지
Table community_article_images {
  id integer [primary key, increment]
  article_id integer [ref: > community_articles.id]
  image_url varchar [not null] // 이미지 경로
  sort_order integer [default: 0] // 이미지 순서
  created_at timestamp [default: `now()`]
}

// 커뮤니티 좋아요
Table community_article_likes {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 작성자
  articles_id integer [ref: - community_articles.id] // 게시물
  created_at timestamp [default: `now()`] // 작성일
}

// 커뮤니티 댓글
Table community_article_replies {
  id integer [primary key, increment]
  user_id integer [ref: > users.id] // 작성자
  articles_id integer [ref: - community_articles.id] // 게시물
  parent_reply_id integer [ref: > community_article_replies.id] // 대댓글 자기참조
  created_at timestamp [default: `now()`] // 작성일
  updated_at timestamp // 업뎃일
  is_delete boolean [default: false] // 논리적 삭제 여부
  delete_at timestamp // 논리적 삭제 일시
}

// 포트폴리오 복사 이력(통계용)
Table portfolio_copy_history {
  id integer [primary key, increment]
  source_portfolio_id integer [ref: > portfolios.id] // 원본 포폴
  target_user_id integer [ref: > users.id] // 복사해간 유저
  created_at timestamp [default: `now()`]
}

// 토큰 지갑(phase 3)
Table token_wallet {
  id integer [primary key, increment]
  user_id integer [ref: > users.id]
}

// 결제 내역(phase 3)
Table payment_history {
  id integer [primary key, increment]
  user_id integer [ref: > users.id]
}