# ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬ (Portfolio Management)

## μ”μ•½ β΅

- μ‚¬μ©μλ‹Ή μµλ€ 5κ° ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬ (μµμ† 1κ° μ μ§€)
- ν¬νΈν΄λ¦¬μ¤λ³„ μΆ…λ© κ΄€λ¦¬ (CRUD), ν„μ¬ λΉ„μ¨ μ‹¤μ‹κ°„ ν‘μ‹
- [P1] κΈ°λ³Έ CRUD + μ •λ ¬ + ν„κΈ μμ‚° / [P2] ν¬νΈν΄λ¦¬μ¤ κ³µμ  + μƒ‰μƒ νƒκ·Έ + λ€μ‹λ³΄λ“ μ»¤μ¤ν„°λ§μ΄μ§•
- νμ›κ°€μ… μ‹ 'κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤' μλ™ μƒμ„±
- μ‚­μ  μ‹ ν™•μΈ μ μ°¨ ν•„μ (μ‹¤μ λ°©μ§€)

---

## Phase 1 (ν„μ¬)

### κΈ°λ¥ λ©λ΅

- [x] ν¬νΈν΄λ¦¬μ¤ μƒμ„± (Create)
- [x] ν¬νΈν΄λ¦¬μ¤ λ©λ΅ μ΅°ν (Read)
- [x] ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ μ΅°ν (Read)
- [x] ν¬νΈν΄λ¦¬μ¤ μμ • (Update)
- [x] ν¬νΈν΄λ¦¬μ¤ μ‚­μ  (Delete)
- [x] ν¬νΈν΄λ¦¬μ¤ μ •λ ¬ μμ„ λ³€κ²½
- [x] νμ›κ°€μ… μ‹ 'κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤' μλ™ μƒμ„±
- [ ] ν¬νΈν΄λ¦¬μ¤ μ΄ ν‰κ°€κΈμ•΅ ν‘μ‹
- [P1] **ν„κΈ μμ‚° κ΄€λ¦¬** μ¶”κ°€

### μƒμ„Έ κ·μΉ™

#### 1. ν¬νΈν΄λ¦¬μ¤ μ ν• μ‚¬ν•­

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μµλ€ κ°μ** | 5κ° (μ‚¬μ©μλ‹Ή) |
| **μµμ† κ°μ** | 1κ° (λ§μ§€λ§‰ ν¬νΈν΄λ¦¬μ¤ μ‚­μ  μ‹ λΉ ν¬νΈν΄λ¦¬μ¤ μλ™ μƒμ„±) |
| **κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤** | νμ›κ°€μ… μ‹ μλ™ μƒμ„± (μ΄λ¦„: 'κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤', is_default: true) |
| **5κ° μ΄κ³Ό μ‹** | 'μµλ€ 5κ°κΉμ§€ λ§λ“¤ μ μμµλ‹λ‹¤' ν† μ¤νΈ λ©”μ‹μ§€ + μƒμ„± λ²„νΌ λΉ„ν™μ„±ν™” |

#### 2. ν¬νΈν΄λ¦¬μ¤ μ†μ„±

| μ†μ„± | ν•„μ μ—¬λ¶€ | κ·μΉ™ |
|------|----------|------|
| **μ΄λ¦„** | ν•„μ | 1~20μ, νΉμλ¬Έμ μ ν• (!@#$%^&* ν—μ© μ• ν•¨) |
| **μ„¤λ…/λ©”λ¨** | μ„ νƒ | 0~100μ, λΉ„μ–΄μμ–΄λ„ λ¬΄λ°© |
| **μƒμ„±μΌ** | μλ™ | μ„λ²„ νƒ€μ„μ¤νƒ¬ν”„ (TIMESTAMP) |
| **μμ •μΌ** | μλ™ | μ—…λ°μ΄νΈ μ‹ μλ™ κ°±μ‹  (TIMESTAMP) |
| **μ •λ ¬ μμ„** | μλ™ | display_order (INT, μ‚¬μ©μ μ§€μ • μμ„) |

#### 3. ν¬νΈν΄λ¦¬μ¤ μƒμ„±

```
ν”λ΅μ°:
1. '+' λ²„νΌ ν΄λ¦­
2. ν¬νΈν΄λ¦¬μ¤ μ΄λ¦„ μ…λ ¥ (ν•„μ)
3. μ„¤λ…/λ©”λ¨ μ…λ ¥ (μ„ νƒ)
4. 'λ§λ“¤κΈ°' λ²„νΌ ν΄λ¦­
5. μ„λ²„ μ €μ¥ ν›„ λ©λ΅μ— μ¶”κ°€ ν‘μ‹
```

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μ…λ ¥ λ°©μ‹** | λ¨λ‹¬/λ°”ν…€ μ‹νΈ (λ¨λ°”μΌ ν™κ²½μ— μ ν•©) |
| **μ ν¨μ„± κ²€μ‚¬** | μ΄λ¦„ 1~20μ, νΉμλ¬Έμ μ°¨λ‹¨ |
| **μ €μ¥ μ‹¤ν¨ μ‹** | μ—λ¬ λ©”μ‹μ§€ ν‘μ‹ + λ¨λ‹¬ μ μ§€ (μ…λ ¥κ°’ λ³΄μ΅΄) |
| **μ„±κ³µ ν›„** | λ©λ΅ ν™”λ©΄μΌλ΅ μ΄λ™ + 'ν¬νΈν΄λ¦¬μ¤κ°€ μƒμ„±λμ—μµλ‹λ‹¤' ν† μ¤νΈ |

#### 4. ν¬νΈν΄λ¦¬μ¤ λ©λ΅ μ΅°ν

| ν‘μ‹ μ •λ³΄ | λ‚΄μ© |
|----------|------|
| **μ΄λ¦„** | ν¬νΈν΄λ¦¬μ¤ μ΄λ¦„ (20μ μ΄κ³Ό μ‹ ... μ²λ¦¬) |
| **μΆ…λ© μ** | nκ° μΆ…λ© |
| **μ΄ ν‰κ°€κΈμ•΅** | λ¨λ“  μΆ…λ©μ ν‰κ°€κΈμ•΅ ν•©κ³„ (μ› λ‹¨μ„, μ½¤λ§ κµ¬λ¶„) |
| **μμ •μΌ** | λ§μ§€λ§‰ μμ • μ‹κ°„ (μ: 2λ¶„ μ „, 1μ‹κ°„ μ „, 2024-12-31) |

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μ •λ ¬ μμ„** | μ‚¬μ©μ μ§€μ • μμ„ (display_order) β†’ μμ •μΌ λ‚΄λ¦Όμ°¨μ |
| **λΉ λ©λ΅** | 'ν¬νΈν΄λ¦¬μ¤λ¥Ό μ¶”κ°€ν•΄λ³΄μ„Έμ”' λ©”μ‹μ§€ + '+' λ²„νΌ |
| **νƒ­ μ•΅μ…** | ν•΄λ‹Ή ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ ν™”λ©΄ μ΄λ™ |
| **μ¤μ™€μ΄ν”„** | μ™Όμ½: μμ •, μ¤λ¥Έμ½: μ‚­μ  |

#### 5. ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ μ΅°ν

| ν‘μ‹ μμ—­ | λ‚΄μ© |
|----------|------|
| **ν—¤λ”** | ν¬νΈν΄λ¦¬μ¤ μ΄λ¦„, μ„¤λ…/λ©”λ¨, νΈμ§‘ λ²„νΌ |
| **μ”μ•½ μΉ΄λ“** | μ΄ ν‰κ°€κΈμ•΅, μΆ…λ© μ, λ¦¬λ°Έλ°μ‹± ν•„μ” μ—¬λ¶€ |
| **μΆ…λ© λ©λ΅** | μΆ…λ©λ…, ν„μ¬κ°€, λ³΄μ μλ‰, ν‰κ°€κΈμ•΅, ν„μ¬ λΉ„μ¨, λ©ν‘ λΉ„μ¨ |
| **ν•λ‹¨ λ²„νΌ** | 'μΆ…λ© μ¶”κ°€', 'λ¦¬λ°Έλ°μ‹± ν™•μΈ' |

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μΆ…λ© μ—†μ** | 'μΆ…λ©μ„ μ¶”κ°€ν•΄λ³΄μ„Έμ”' λ©”μ‹μ§€ + 'μΆ…λ© μ¶”κ°€' λ²„νΌ |
| **μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ** | μ¥μ¤‘ 30μ΄~1λ¶„ κ°„κ²© μ—…λ°μ΄νΈ (ν„μ¬κ°€, ν‰κ°€κΈμ•΅, λΉ„μ¨) |
| **μλ™ μƒλ΅κ³ μΉ¨** | Pull-to-refresh μ μ¤μ²λ΅ μ¦‰μ‹ μ—…λ°μ΄νΈ |

#### 6. ν¬νΈν΄λ¦¬μ¤ μμ •

```
ν”λ΅μ°:
1. μƒμ„Έ ν™”λ©΄μ—μ„ 'νΈμ§‘' λ²„νΌ ν΄λ¦­
2. μ΄λ¦„, μ„¤λ…/λ©”λ¨ μμ •
3. 'μ €μ¥' λ²„νΌ ν΄λ¦­
4. μ„λ²„ μ—…λ°μ΄νΈ ν›„ ν™”λ©΄ λ°μ
```

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μμ • κ°€λ¥ ν•­λ©** | μ΄λ¦„, μ„¤λ…/λ©”λ¨ |
| **μμ • λ¶κ°€** | μƒμ„±μΌ, μΆ…λ© μ, μ΄ ν‰κ°€κΈμ•΅ (μλ™ κ³„μ‚°κ°’) |
| **μ €μ¥ μ‹¤ν¨ μ‹** | μ—λ¬ λ©”μ‹μ§€ + νΈμ§‘ λ¨λ“ μ μ§€ |
| **μ·¨μ†** | 'μ·¨μ†' λ²„νΌ ν΄λ¦­ μ‹ λ³€κ²½μ‚¬ν•­ νκΈ° |

#### 7. ν¬νΈν΄λ¦¬μ¤ μ‚­μ 

```
ν”λ΅μ°:
1. λ©λ΅μ—μ„ μ¤μ™€μ΄ν”„ β†’ 'μ‚­μ ' λ²„νΌ
2. ν™•μΈ λ‹¤μ΄μ–Όλ΅κ·Έ ν‘μ‹
   - μ λ©: 'ν¬νΈν΄λ¦¬μ¤ μ‚­μ '
   - λ‚΄μ©: '[ν¬νΈν΄λ¦¬μ¤λ…]μ„ μ‚­μ ν•μ‹κ² μµλ‹κΉ? λ¨λ“  μΆ…λ© λ°μ΄ν„°κ°€ μ‚­μ λ©λ‹λ‹¤.'
   - λ²„νΌ: 'μ·¨μ†', 'μ‚­μ ' (λΉ¨κ°„μƒ‰)
3. 'μ‚­μ ' ν™•μΈ μ‹ μ„λ²„μ—μ„ μ‚­μ 
4. λ©λ΅μ—μ„ μ κ±° + 'μ‚­μ λμ—μµλ‹λ‹¤' ν† μ¤νΈ
```

| ν•­λ© | κ·μΉ™ |
|------|------|
| **λ§μ§€λ§‰ 1κ° μ‚­μ ** | λΉ 'κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤' μλ™ μƒμ„± (μµμ† 1κ° μ μ§€) |
| **μΆ…λ© ν¬ν•¨ μ‹** | λ¨λ“  μΆ…λ©λ„ ν•¨κ» μ‚­μ  (CASCADE) |
| **μ‚­μ  μ·¨μ† λ¶κ°€** | ν• λ² μ‚­μ ν•λ©΄ λ³µκµ¬ λ¶κ°€ (Phase 1) |

#### 8. ν¬νΈν΄λ¦¬μ¤ μ •λ ¬ μμ„ λ³€κ²½

| ν•­λ© | κ·μΉ™ |
|------|------|
| **λ³€κ²½ λ°©μ‹** | κΈ΄ λ„λ¦„ (Long Press) β†’ λ“λκ·Έν•μ—¬ μμ„ λ³€κ²½ |
| **μ €μ¥** | μμ„ λ³€κ²½ μ¦‰μ‹ μ„λ²„μ— display_order μ—…λ°μ΄νΈ |
| **μ‹¤ν¨ μ‹** | μ›λ μμ„λ΅ λ³µκµ¬ + μ—λ¬ λ©”μ‹μ§€ |

#### 9. ν„κΈ μμ‚° κ΄€λ¦¬ (P1)

| ν•­λ© | κ·μΉ™ |
|------|------|
| **μμ‚° μ ν•** | μΆ…λ© μ™Έ 'ν„κΈ'μ„ ν•λ‚μ μμ‚° ν΄λμ¤λ΅ μ·¨κΈ‰ |
| **μ§€μ› ν†µν™”** | KRW(μ›ν™”), USD(λ‹¬λ¬) |
| **λ¦¬λ°Έλ°μ‹± ν¬ν•¨** | λ¦¬λ°Έλ°μ‹± κ³„μ‚° μ‹ ν„κΈ λΉ„μ¤‘λ„ μμ‚° λ°°λ¶„ λ€μƒμ— ν¬ν•¨ |
| **ν‘μ‹** | ν¬νΈν΄λ¦¬μ¤ κµ¬μ„± λΉ„μ¨ μ°¨νΈμ— 'ν„κΈ' ν•­λ© ν‘μ‹ |

---

## Phase 2+ (ν™•μ¥ κ³ λ ¤μ‚¬ν•­)

### [P2] λ€μ‹λ³΄λ“ μ»¤μ¤ν„°λ§μ΄μ§•

- **μΉ΄λ“ λ°°μΉ μ„¤μ •**: λ“λκ·Έ μ•¤ λ“λ΅­μΌλ΅ μΆ…λ© μΉ΄λ“ μμ„ λ³€κ²½
- **λ³΄κΈ° λ¨λ“ λ³€κ²½**: λ¦¬μ¤νΈ λ·° / μΉ΄λ“ λ·° / μ°¨νΈ λ·° μ „ν™ μ„¤μ • μ €μ¥

### [P2] ν¬νΈν΄λ¦¬μ¤ κ³µμ 

- ν¬νΈν΄λ¦¬μ¤ λ§ν¬ μƒμ„± ν›„ μΉκµ¬μ™€ κ³µμ 
- κ³µμ  μ„¤μ •: κ³µκ°/λΉ„κ³µκ°, μ½κΈ° μ „μ©/νΈμ§‘ κ°€λ¥
- κ³µμ λ ν¬νΈν΄λ¦¬μ¤ μ΅°ν μ „μ© νμ΄μ§€

**P1 μ„¤κ³„ μ‹ κ³ λ ¤μ‚¬ν•­**:
- [P2-κ³ λ ¤] portfolios ν…μ΄λΈ”μ— `is_public` (BOOLEAN) μ»¬λΌ λ―Έλ¦¬ μ¶”κ°€
- [P2-κ³ λ ¤] `share_token` (VARCHAR(255), UNIQUE) μ»¬λΌ μμ•½
- [P2-κ³ λ ¤] portfolio_shares ν…μ΄λΈ” κµ¬μ΅° λ―Έλ¦¬ μ„¤κ³„

### [P2] μƒ‰μƒ νƒκ·Έ

- ν¬νΈν΄λ¦¬μ¤λ³„ μƒ‰μƒ νƒκ·Έ μ„¤μ • (8κ°€μ§€ μƒ‰μƒ)
- λ©λ΅ ν™”λ©΄μ—μ„ μƒ‰μƒμΌλ΅ κµ¬λ¶„ μ©μ΄

**P1 μ„¤κ³„ μ‹ κ³ λ ¤μ‚¬ν•­**:
- [P2-κ³ λ ¤] portfolios ν…μ΄λΈ”μ— `color_tag` (VARCHAR(20)) μ»¬λΌ μμ•½

### [P2] ν¬νΈν΄λ¦¬μ¤ λ³µμ‚¬

- κΈ°μ΅΄ ν¬νΈν΄λ¦¬μ¤λ¥Ό λ³µμ‚¬ν•μ—¬ μƒ ν¬νΈν΄λ¦¬μ¤ μƒμ„±
- λ¨λ“  μΆ…λ© λ°μ΄ν„° ν•¨κ» λ³µμ‚¬

**ν„μ¬ μν–¥ μ—†μ** - Phase 1 APIμ™€ λ…λ¦½μ 

### [P3] μΉ΄ν…κ³ λ¦¬/ν΄λ” κΈ°λ¥

- ν¬νΈν΄λ¦¬μ¤λ¥Ό μΉ΄ν…κ³ λ¦¬λ³„λ΅ λ¶„λ¥ (μ: 'ν¬μ', 'κ΄€μ‹¬ μΆ…λ©', 'μ—°κΈ')
- ν΄λ” λ° ν•μ„ ν΄λ” κµ¬μ΅° μ§€μ›

**P1 μ„¤κ³„ μ‹ κ³ λ ¤μ‚¬ν•­**:
- [P3-κ³ λ ¤] portfolios ν…μ΄λΈ”μ— `parent_id` (FK) μ»¬λΌ μμ•½
- [P3-κ³ λ ¤] portfolio_categories ν…μ΄λΈ” κµ¬μ΅° μ„¤κ³„

### [P3] ν¬νΈν΄λ¦¬μ¤ ν†µκ³„

- μΌλ³„/μ£Όλ³„/μ›”λ³„ μμµλ¥  μ°¨νΈ
- μΆ…λ©λ³„ λΉ„μ¤‘ λ³€ν™” μ¶”μ΄

**ν„μ¬ μν–¥ μ—†μ** - Phase 1/2 κµ¬ν„κ³Ό λ…λ¦½μ 

---

## API μ—”λ“ν¬μΈνΈ

### 1. ν¬νΈν΄λ¦¬μ¤ λ©λ΅ μ΅°ν

```
GET /api/portfolios
```

**Request Headers**:
```
Authorization: Bearer {access_token}
```

**Response**:
```json
{
  "portfolios": [
    {
      "id": "uuid",
      "name": "string",
      "description": "string",
      "is_default": false,
      "display_order": 1,
      "stock_count": 5,
      "total_value": 10000000,
      "updated_at": "2024-12-31T12:00:00Z"
    }
  ]
}
```

### 2. ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ μ΅°ν

```
GET /api/portfolios/{id}
```

**Response**:
```json
{
  "id": "uuid",
  "name": "string",
  "description": "string",
  "is_default": false,
  "display_order": 1,
  "stocks": [
    {
      "id": "uuid",
      "stock_code": "005930",
      "stock_name": "μ‚Όμ„±μ „μ",
      "quantity": 10.0,
      "current_price": 75000,
      "value": 750000,
      "current_ratio": 25.5,
      "target_ratio": 30.0
    }
  ],
  "total_value": 10000000,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-12-31T12:00:00Z"
}
```

### 3. ν¬νΈν΄λ¦¬μ¤ μƒμ„±

```
POST /api/portfolios
```

**Request Body**:
```json
{
  "name": "string",
  "description": "string"
}
```

**Response**:
```json
{
  "id": "uuid",
  "name": "string",
  "description": "string",
  "is_default": false,
  "display_order": 2,
  "created_at": "2024-12-31T12:00:00Z"
}
```

### 4. ν¬νΈν΄λ¦¬μ¤ μμ •

```
PUT /api/portfolios/{id}
```

**Request Body**:
```json
{
  "name": "string",
  "description": "string"
}
```

### 5. ν¬νΈν΄λ¦¬μ¤ μ‚­μ 

```
DELETE /api/portfolios/{id}
```

**Response**:
```json
{
  "message": "μ‚­μ λμ—μµλ‹λ‹¤"
}
```

### 6. ν¬νΈν΄λ¦¬μ¤ μμ„ λ³€κ²½

```
PATCH /api/portfolios/reorder
```

**Request Body**:
```json
{
  "orders": [
    {"id": "uuid1", "display_order": 1},
    {"id": "uuid2", "display_order": 2}
  ]
}
```

---

## κ²€μ¦ κ·μΉ™

### μ…λ ¥ κ²€μ¦

| ν•„λ“ | κ·μΉ™ | μ—λ¬ λ©”μ‹μ§€ |
|------|------|------------|
| **name** | 1~20μ, νΉμλ¬Έμ μ ν• | 'ν¬νΈν΄λ¦¬μ¤ μ΄λ¦„μ€ 1~20μμ—¬μ•Ό ν•©λ‹λ‹¤' |
| **description** | 0~100μ | 'μ„¤λ…μ€ 100μλ¥Ό μ΄κ³Όν•  μ μ—†μµλ‹λ‹¤' |
| **μµλ€ κ°μ** | 5κ° μ ν• | 'μµλ€ 5κ°κΉμ§€ λ§λ“¤ μ μμµλ‹λ‹¤' |

### λΉ„μ¦λ‹μ¤ λ΅μ§ κ²€μ¦

| μ‹λ‚λ¦¬μ¤ | μ²λ¦¬ |
|----------|------|
| 5κ° μ΄κ³Ό μƒμ„± μ‹λ„ | 400 Bad Request + μ—λ¬ λ©”μ‹μ§€ |
| λ§μ§€λ§‰ 1κ° μ‚­μ  | λΉ 'κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤' μλ™ μƒμ„± |
| μ΅΄μ¬ν•μ§€ μ•λ” ID μ΅°ν | 404 Not Found |
| λ‹¤λ¥Έ μ‚¬μ©μ ν¬νΈν΄λ¦¬μ¤ μ ‘κ·Ό | 403 Forbidden |

---

## κ΄€λ ¨ λ¬Έμ„

- **DB**: `reference/db-schema.md#portfolios`
- **API**: `reference/api-spec.md#portfolio-endpoints`
- **μΆ…λ© κ΄€λ¦¬**: `features/stock.md`
- **λ¦¬λ°Έλ°μ‹±**: `features/rebalancing.md`

---

> π“… **μ‘μ„±μΌ**: 2025-12-31  
> π“ **Phase**: Phase 1 (MVP)  
> π― **μ¤‘μ”λ„**: ν•„μ (Blocker)
