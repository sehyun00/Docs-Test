# 화면 기획서: 리밸런싱 분석

> **Screen ID**: `screen-rebalance`  
> **Phase**: 1 (MVP)  
> **우선순위**: P1 ⭐⭐⭐ (핵심 기능)  
> **마지막 수정**: 2026-01-04

---

## 📋 화면 개요

| 항목 | 내용 |
|-----|------|
| **화면명** | 리밸런싱 분석 |
| **목적** | 목표 비율 달성을 위한 매수/매도 가이드 제공 |
| **진입 경로** | 포트폴리오 상세 → 리밸런싱 분석 버튼 |
| **이동 가능 화면** | ← 포트폴리오 상세, → 임계값 설정 모달 |

### 사용자 스토리
>
> "투자자로서 나는 **구체적인 매수/매도 수량과 금액**을 확인하여 증권사 앱에서 바로 거래를 실행하고 싶다."

---

## 🎯 핵심 사용자 니즈

| 니즈 | 중요도 | 현재 충족 여부 |
|-----|--------|--------------|
| 무엇을 사고 팔아야 하는지 | ⭐⭐⭐⭐ | ✅ |
| 몇 주를 거래해야 하는지 | ⭐⭐⭐⭐ | ✅ |
| 얼마가 필요한지 | ⭐⭐⭐ | ⚠️ (합계 없음) |
| 현재 vs 목표 비교 시각화 | ⭐⭐⭐ | ✅ (도넛) |
| 임계값 개인화 | ⭐⭐ | ✅ |

---

## 🧩 현재 구현 요소

```
┌─────────────────────────────────────┐
│  ←  리밸런싱 분석             ⚙️   │
├─────────────────────────────────────┤
│                                     │
│   ╭─────╮        ╭─────╮           │
│   │현재 │        │목표 │           │
│   │ ●   │        │ ●   │           │
│   ╰─────╯        ╰─────╯           │
│   [범례]          [범례]            │
│                                     │
├─────────────────────────────────────┤
│ 리밸런싱 제안           임계값: ±5% │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 🔵 매도         삼성전자        │ │
│ │ 현재 35% → 목표 30%            │ │
│ │ 권장 수량: -8주                 │ │
│ │ 예상 금액: ₩596,000            │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🔴 매수         카카오          │ │
│ │ 현재 12% → 목표 15%            │ │
│ │ 권장 수량: +20주                │ │
│ │ 예상 금액: ₩974,000            │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🔴 매수         LG에너지솔루션   │ │
│ │ 현재 8% → 목표 10%             │ │
│ │ 권장 수량: +2주                 │ │
│ │ 예상 금액: ₩648,500            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 💡 개선 아이디어

### 1. 차트 형태 개선

#### 현재: 도넛 차트 2개

- **문제**: 종목별 비교가 어려움

#### 제안 A: 가로 비교 바

```
삼성전자   현재 ██████████████▓▓  35%
           목표 ██████████████     30%
                               [-5%p]

SK하이닉스 현재 ██████████        25%
           목표 ██████████        25%
                               [적정]
```

#### 제안 B: 하이브리드 (권장) ✅

```
┌─ 요약 ─────────────────────────────┐
│    ╭───╮              ╭───╮        │
│    │●  │      →       │●  │        │
│    ╰───╯              ╰───╯        │
│   불균형              균형          │
│   "3종목 조정 필요"                 │
└─────────────────────────────────────┘
```

- 요약: 작은 도넛으로 전체 상태만 표시
- 상세: 액션 카드에 집중

### 2. 총 필요 자금 표시 ⭐⭐⭐

```
┌─────────────────────────────────────┐
│ 💰 리밸런싱 비용 요약               │
│ ───────────────────────────────── │
│ 매도 예상 수익    +₩596,000        │
│ 매수 필요 금액    -₩1,622,500      │
│ ───────────────────────────────── │
│ 추가 필요 자금    ₩1,026,500       │
└─────────────────────────────────────┘
```

### 3. 예산 내 리밸런싱 모드

```
┌─────────────────────────────────────┐
│ 💵 사용 가능한 금액 설정            │
│ ┌─────────────────────────────────┐ │
│ │ ₩500,000                       │ │
│ └─────────────────────────────────┘ │
│ [예산 내에서 리밸런싱 계산]         │
└─────────────────────────────────────┘
```

- 제한된 금액 내에서 최적 리밸런싱 제안
- **Phase 2 기능으로 권장**

### 4. 리밸런싱 시뮬레이션

```
┌─────────────────────────────────────┐
│ 📊 리밸런싱 후 예상 비율            │
│                                     │
│ 삼성전자      30.0% ✓              │
│ SK하이닉스    25.0% ✓              │
│ NAVER        20.0% ✓              │
│ 카카오        15.0% ✓              │
│ LG에너지솔루션 10.0% ✓              │
│ ─────────────────                  │
│ 합계: 100.0%                       │
└─────────────────────────────────────┘
```

### 5. 액션 카드 개선

```
┌───────────────────────────────────────┐
│ 🔴 매수                    카카오    │
│ ─────────────────────────────────── │
│                                      │
│ 비율 변화    12% ━━━|███▌ → 15%     │
│              현재      목표          │
│                                      │
│ ┌─────────┬─────────┬─────────────┐ │
│ │권장 수량 │ 현재가  │ 예상 금액   │ │
│ │ +20주   │ ₩48,700│ ₩974,000   │ │
│ └─────────┴─────────┴─────────────┘ │
│                                      │
│        [복사] [증권사 앱 열기]        │
└───────────────────────────────────────┘
```

### 6. 거래 정보 복사

```
[복사] 버튼 탭 시:

"카카오(035720) 20주 매수
현재가 기준 약 ₩974,000"

→ 클립보드에 복사됨
→ 토스트: "복사되었습니다"
```

### 7. 리밸런싱 완료 기록

```
[리밸런싱 완료] 버튼

→ 현재 시점 기록
→ Phase 2에서 히스토리 확인
```

---

## ⚠️ 엣지 케이스 및 에러 상태

| 상황 | 현재 처리 | 권장 처리 |
|-----|----------|----------|
| 리밸런싱 불필요 | ❌ 없음 | "모든 종목이 목표 범위 내입니다 ✓" |
| 종목 1개만 있음 | ❌ 없음 | "리밸런싱을 위해 2개 이상의 종목이 필요합니다" |
| 시세 조회 실패 | ❌ 없음 | 마지막 캐시 데이터 + 경고 |
| 매우 소액 조정 | ❌ 없음 | "조정 금액이 10,000원 미만입니다" 안내 |

### 리밸런싱 불필요 상태

```
┌─────────────────────────────────────┐
│                                     │
│              ✅                     │
│                                     │
│    모든 종목이 목표 범위 내입니다   │
│                                     │
│    현재 임계값: ±5%                 │
│                                     │
│         [임계값 조정하기]           │
│                                     │
└─────────────────────────────────────┘
```

---

## 🔄 화면 상태 (States)

### 1. Loading State

```
┌─────────────────────────────────────┐
│   ⟳ 시세 정보를 불러오는 중...      │
│                                     │
│   ░░░░░░░░░░░░░░░░░░               │
│   ░░░░░░░░░░░░░░░░░░               │
└─────────────────────────────────────┘
```

### 2. Refresh 중

```
[헤더] 리밸런싱 분석  ⟳ 업데이트 중...
```

---

## 📊 임계값 설정 모달

```
┌─────────────────────────────────────┐
│ 임계값 설정                     [X] │
├─────────────────────────────────────┤
│                                     │
│ 목표 비율 대비 이 값을 초과하면     │
│ 리밸런싱을 권장합니다              │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ ○ ±3%    민감하게 관리          │ │
│ ├─────────────────────────────────┤ │
│ │ ● ±5%    권장                   │ │
│ ├─────────────────────────────────┤ │
│ │ ○ ±10%   느슨하게 관리          │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │           저장                   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 커스텀 임계값 (Phase 2)

```
│ ○ 직접 입력: [___]%                 │
```

---

## 📐 색상 규칙 (한국 증시 관례)

| 액션 | 색상 | HEX |
|-----|------|-----|
| 매수 | 🔴 빨강 | `#E53935` |
| 매도 | 🔵 파랑 | `#1E88E5` |
| 적정 | ⚫ 회색 | `#9E9E9E` |

---

## ✅ 체크리스트

### MVP (Phase 1)

- [x] 현재/목표 비율 도넛 `[직접]`
- [x] 매수/매도 액션 카드 `[직접]`
- [x] 권장 수량 및 금액 `[직접]`
- [x] 임계값 설정 `[직접]`
- [ ] 총 필요 자금 요약 `[직접]`
- [ ] 리밸런싱 불필요 상태 UI `[패널]`
- [ ] 복사 기능 `[직접]`

### Phase 2

- [ ] 예산 내 리밸런싱
- [ ] 리밸런싱 이력 기록
- [ ] 알림 연동 ("리밸런싱 완료" 기록)
- [ ] 가로 비교 바 차트 옵션

---

## 🔗 관련 문서

- [04_portfolio_detail.md](./04_portfolio_detail.md) - 이전 화면
- [ux_design_recommendations.md](../ux_design_recommendations.md) - 차트 및 색상 가이드
