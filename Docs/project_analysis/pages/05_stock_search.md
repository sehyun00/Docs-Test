# 화면 기획서: 종목 검색/추가

> **Screen ID**: `screen-search`  
> **Phase**: 1 (MVP)  
> **우선순위**: P1  
> **마지막 수정**: 2026-01-04

---

## 📋 화면 개요

| 항목 | 내용 |
|-----|------|
| **화면명** | 종목 검색/추가 |
| **목적** | 포트폴리오에 새 종목 추가 |
| **진입 경로** | 포트폴리오 상세 → 종목 추가 버튼 |
| **이동 가능 화면** | ← 포트폴리오 상세, → 종목 추가 모달 |

### 사용자 스토리
>
> "투자자로서 나는 **종목을 빠르게 검색**하고, 보유 수량과 목표 비율을 설정하여 포트폴리오에 추가하고 싶다."

---

## 🎯 핵심 사용자 니즈

| 니즈 | 중요도 | 현재 충족 여부 |
|-----|--------|--------------|
| 빠른 검색 | ⭐⭐⭐ | ⚠️ (실시간 자동완성 없음) |
| 현재가 확인 | ⭐⭐⭐ | ✅ |
| 목표 비율 설정 | ⭐⭐⭐ | ✅ |
| 비율 합계 확인 | ⭐⭐ | ❌ |
| 중복 종목 방지 | ⭐⭐ | ❌ |

---

## 🧩 현재 구현 요소

### 검색 화면

```
┌─────────────────────────────────────┐
│  ←  종목 추가                       │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 🔍 현대                         │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 현대자동차                          │
│ 005380           ₩186,500  +1.24%  │
│─────────────────────────────────────│
│ 현대모비스                          │
│ 012330           ₩252,000  -0.79%  │
│─────────────────────────────────────│
│ 현대건설                            │
│ 000720           ₩31,450   +2.11%  │
│─────────────────────────────────────│
│ 현대제철                            │
│ 004020           ₩33,800   +0.45%  │
└─────────────────────────────────────┘
```

### 종목 추가 모달

```
┌─────────────────────────────────────┐
│ 현대자동차                      [X] │
├─────────────────────────────────────┤
│ ₩186,500                   +1.24%  │
├─────────────────────────────────────┤
│ 보유 수량                           │
│         [-]  10주  [+]              │
│         예상 금액: ₩1,865,000       │
├─────────────────────────────────────┤
│ 목표 비율                           │
│ ○━━━━━━●━━━━━━━━━━━━━━○           │
│ 0%      10%                  100%  │
├─────────────────────────────────────┤
│ [취소]              [추가]          │
└─────────────────────────────────────┘
```

---

## 💡 개선 아이디어

### 1. 검색 UX 개선

#### 빈 검색창 상태

```
┌─────────────────────────────────────┐
│ 🔍 종목명 또는 코드 검색           │
├─────────────────────────────────────┤
│ 최근 검색                           │
│ 삼성전자 · SK하이닉스 · 카카오      │
│                                     │
│ 인기 종목                           │
│ 테슬라 · 애플 · 엔비디아            │
└─────────────────────────────────────┘
```

#### 실시간 자동완성

```
검색어: "삼성" (타이핑 중)
         ↓ 0.3초 디바운스
┌─────────────────────────────────────┐
│ 삼성전자                   005930   │
│ 삼성SDI                    006400   │
│ 삼성생명                   032830   │
│ 삼성바이오로직스           207940   │
└─────────────────────────────────────┘
```

### 2. 중복 종목 처리

```
┌─────────────────────────────────────┐
│ 삼성전자                   005930   │
│ [이미 보유 중] 현재 35%            │
│ ₩74,500                    +1.2%  │
└─────────────────────────────────────┘
```

- 탭하면: "이미 보유 중인 종목입니다. 수정하시겠습니까?" 팝업

### 3. 비율 합계 컨텍스트

```
┌─────────────────────────────────────┐
│ 목표 비율                    10%   │
│ ○━━━━●━━━━━━━━━━━━━━━━━━━━━━○      │
├─────────────────────────────────────┤
│ 📊 현재 포트폴리오 비율 합계        │
│ ────────────────────────────────── │
│ 기존 종목: 90%                      │
│ + 현대차: 10%                       │
│ ────────────────────────────────── │
│ 합계: 100% ✓                       │
└─────────────────────────────────────┘
```

### 4. 비율 초과 경고 (구현 완료)

**슬라이더 조작 시 실시간 경고 UI**

```
[정상 상태: 합계 ≤ 100%]              [초과 상태: 합계 > 100%]
┌─────────────────────────┐            ┌─────────────────────────┐
│ 목표 비중             │            │ 목표 비중        ⚠️  │ ← 경고 아이콘
│ ●━━━━━━━━━━━━○ 10%   │            │ ●━━━━━━━━━━━━●━○ 15% │ ← 슬라이더 빨간색
├─────────────────────────┤            ├─────────────────────────┤
│ 기존 종목: 90%        │            │ 기존 종목: 90%        │
│ + 현재: 10%           │            │ + 현재: 15%           │
│ ─────────────────────│            │ ─────────────────────│
│ 합계: 100% ✓          │            │ ⚠️ 합계: 105%         │ ← 빨간 테두리
│                       │            │ 초과분은 상세 화면에서 │
│                       │            │ 조정해주세요          │
├─────────────────────────┤            ├─────────────────────────┤
│ [취소]     [✓ 추가]   │            │ [취소]  [⚠️ 추가]    │ ← 빨간 버튼
└─────────────────────────┘            └─────────────────────────┘
```

**동작 방식:**

- 슬라이더 드래그 시 실시간으로 합계 계산
- 100% 초과 시:
  - 라벨 옆 ⚠️ 아이콘 표시
  - 슬라이더/값 빨간색 변경
  - 합계 영역 빨간 테두리 + 배경
  - 안내 메시지 표시
  - 추가 버튼 빨간색 (클릭은 가능)
- **추가 허용**: 100% 초과해도 추가 가능 (상세 화면에서 수동 조정 유도)

### 5. 수량 입력 개선

```
보유 수량
┌───────────────────────────────────┐
│ [-10] [-1]   50주   [+1] [+10]   │
└───────────────────────────────────┘
         ↑ 직접 입력 가능
```

- 큰 단위 조절 버튼 추가
- 0주 입력 시 경고

### 6. 평균 매입 단가 입력 (MVP 결정 필요)

```
┌─────────────────────────────────────┐
│ 평균 매입가 (선택)                  │
│ ┌─────────────────────────────────┐ │
│ │ ₩                         원   │ │
│ └─────────────────────────────────┘ │
│ * 입력 시 수익률 계산에 반영됩니다  │
└─────────────────────────────────────┘
```

---

## ⚠️ 엣지 케이스 및 에러 상태

| 상황 | 현재 처리 | 권장 처리 |
|-----|----------|----------|
| 검색 결과 없음 | ✅ 구현 | "검색 결과가 없습니다" + 검색어 확인 안내 |
| 네트워크 오류 | ❌ 없음 | "검색 실패. 다시 시도해주세요" |
| 수량 0 입력 | ❌ 없음 | 추가 버튼 비활성화 |
| 이미 보유 종목 | ✅ 구현 | 배지 표시 + 토스트 알림 |
| 비율 합계 초과 | ✅ 구현 | 경고 UI + 추가 허용 + 상세에서 조정 안내 |
| 거래정지 종목 | ❌ 없음 | 경고 표시 (추가는 허용) |

### 검색 결과 없음

```
┌─────────────────────────────────────┐
│              🔍                     │
│                                     │
│    "ㅁㅁㅁ"에 대한                  │
│    검색 결과가 없습니다            │
│                                     │
│    종목명 또는 6자리 종목코드로     │
│    검색해보세요                     │
└─────────────────────────────────────┘
```

---

## 🔄 화면 상태 (States)

### 1. 검색 인풋 상태

```
Default:   [🔍 종목명 또는 코드 검색    ]
Focus:     [🔍 |                        ] ← 커서 깜빡임
Typing:    [🔍 삼성|                  X ] ← X 버튼 표시
Loading:   [🔍 삼성       ⟳            ] ← 검색 중
```

### 2. 모달 버튼 상태

```
수량 0:       [추가] ← 비활성화 (회색)
정상 (≤100%): [추가] ← Primary (초록)
초과 (>100%): [추가] ← Warning (빨강) + 아이콘
저장 중:      [추가 중... ⟳] ← 비활성화
```

---

## 📐 검색 성능 요구사항

| 항목 | 요구사항 |
|-----|---------|
| 디바운스 | 300ms |
| 최소 검색어 | 1자 이상 |
| 최대 결과 | 10개 (스크롤) |
| 응답 시간 | 1초 이내 |

---

## ✅ 체크리스트

### MVP (Phase 1)

- [x] 종목 검색 기능 `[직접]`
- [x] 현재가 표시 `[직접]`
- [x] 보유 수량 입력 (정수, 1주 이상) `[직접]`
- [x] **목표 비율 설정 (필수 입력)** `[직접]`
- [x] 실시간 자동완성 `[직접]`
- [x] **비율 합계 표시 (실시간 계산)** `[직접]`
- [x] **목표 비율 합계 100% 초과 경고 UI** `[직접]`
- [x] 중복 종목 체크 `[직접]`
- [x] 검색 결과 없음 UI `[패널]`

### Phase 2

- [ ] 최근 검색 기록
- [ ] 인기 종목 추천
- [ ] 평균 매입 단가 입력
- [ ] 미국 주식 검색 지원
- [ ] 소수점 거래 지원 (0.0001주)

---

## 🔗 관련 문서

- [04_portfolio_detail.md](./04_portfolio_detail.md) - 이전 화면
- [modal_stock_add.md](./modal_stock_add.md) - 종목 추가 모달 상세
