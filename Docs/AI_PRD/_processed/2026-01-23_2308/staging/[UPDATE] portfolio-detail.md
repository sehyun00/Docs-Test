---
batch: 2026-01-23_2308
domain: portfolio
type: update
---
# 포트폴리오 상세 (Detail) 고도화

## 1. 개요

Inbox의 `04_portfolio_detail.md` 요구사항을 반영하여 포트폴리오 상세 화면의 요약 정보를 강화하고, UI 상호작용을 개선합니다.

## 2. 변경 사항 요약

| 구분          | 항목      | 변경 내용                                                          |
| ------------- | --------- | ------------------------------------------------------------------ |
| **UI**  | 요약 카드 | 총 매입금, 수익금, 수익률 표시 추가                                |
| **UI**  | 상호작용  | 종목 카드 탭 동작 변경 (수정 시트 → 상세 모달)                    |
| **API** | Response  | `totalBuyAmount`, `totalProfit`, `totalProfitRate` 필드 추가 |

## 3. 상세 스펙 변경

### A. [UI] `specs/ui/portfolio/detail.md`

#### 수정: 요약 카드 (Summary Card)

기존 `총 평가금액`, `현금` 외에 수익률 정보를 추가합니다.

```markdown
### 2. 요약 카드

| 요소 | 설명 | 비고 |
|------|------|------|
| 총 평가금액 | 포트폴리오 총 자산 (종목 + 현금) | |
| **총 매입금** | 종목 매입금 합계 + 현금 | **[추가]** |
| **수익금** | 총 평가금액 - 총 매입금 | **[추가]** |
| **수익률** | (수익금 / 총 매입금) * 100 | **[추가]** |
| 현금 | 보유 현금 (KRW/USD) | |
```

#### 수정: 상호작용 (Interaction)

종목 카드 탭 시 수정 화면이 아닌 상세 정보 모달을 띄우도록 변경합니다. (편집은 별도 버튼/메뉴로 접근)

```markdown
| 액션 | 동작 |
|------|------|
| **종목 카드 탭** | **종목 상세 모달 (보유 수량, 평단가 상세 확인)** |
| 종목 좌측 스와이프 | 삭제 버튼 |
```

---

### B. [API] `specs/api/portfolio/detail.md`

#### 수정: Response Field

요약 카드에 필요한 데이터를 루트 객체에 추가합니다.

```json
{
  "id": "uuid",
  // ... 기존 필드 ...
  "totalValue": 10000000,
  "cashKrw": 1000000,
  "cashUsd": 500.0,
  
  // [NEW] 수익 현황 필드 추가
  "totalBuyAmount": 9000000,   // 총 매입금 (현금 포함 여부 정책 결정 필요)
  "totalProfit": 1000000,      // 수익금
  "totalProfitRate": 11.1,     // 수익률 (%)
  
  "stocks": [...]
}
```

> **구현 로직 업데이트**:
> 4. 각 종목 계산 시 `averagePrice` 활용하여 `buyAmount` 계산 필요
> 5. 전체 포트폴리오의 `totalBuyAmount` 합산
> 6. 수익률 계산 로직 추가

## 4. AI 분석 및 확인 사항

### 🔍 논리적 검증

- **DB 영향도**: `portfolio_stocks` 테이블에 `average_price` 컬럼이 이미 존재하므로 DB 스키마 변경 불필요.
- **계산 정책**:
  - `총 매입금`에 현금을 포함할 것인가?
  - 보통 수익률 = (평가금 - 매입금) / 매입금.
  - 현금은 매입금 = 평가금(1:1)으로 치면 수익률 희석됨.
  - 주식 투자 성과만 보려면 **(총 주식 평가금 - 총 주식 매입금) / 총 주식 매입금**이 맞을 수 있음.
  - 하지만 UI에 "총 자산" 대비 수익을 보여준다면 현금 포함 전체 수익률일 수도 있음. Inbox 예시는 "현금 5%, 총 매입금, 수익금"이 나란히 있어 전체 기준 같음.

### ❓ 확인 필요 사항

#### 1. 수익률 계산 기준 (Profit Logic)

요약 카드의 '수익률' 계산 시 현금을 포함합니까?

- [X] **옵션 A (전체 자산 기준)**: (총 평가금 - (주식매입금 + 현금)) / (주식매입금 + 현금). (현금 비중이 높으면 수익률 변동폭 작아짐)
- [ ] **옵션 B (투자 자산 기준)**: (주식 평가금 - 주식 매입금) / 주식 매입금. (순수 주식 성과만 표시. 현금은 수익 0으로 간주하거나 제외)
- [ ] 기타: ________________

#### 2. 종목 카드 탭 동작 (Interaction)

기존 스펙은 '수정 시트'였으나 Inbox는 '상세 모달'입니다. 상세 모달에서 '수정'으로 진입하는 버튼이 있습니까?

- [ ] **옵션 A**: 상세 모달 내에 '수정' 버튼이 있음
- [X] **옵션 B**: 상세 모달은 조회만 가능, 수정은 목록에서 스와이프나 편집 모드에서만 가능
- [ ] 기타: ________________
